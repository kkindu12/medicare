
<div class="pharmacy-dashboard">
  <!-- Header -->
  <div class="header">
    <div class="logo-section">
      <div class="logo-icon">💊</div>
      <h1>PharmLab System</h1>
    </div>
    <div class="user-section">
      <div class="notification-icon">🔔</div>
      <div class="user-info">
        <div class="user-avatar">👤</div>
        <span class="user-name">Dr. Pharmacy</span>
        <div class="dropdown-arrow">▼</div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <div class="welcome-header">
        <div class="welcome-text">
          <h2>Welcome back, Dr. Pharmacy!</h2>
          <div class="priority-notice">
            <span class="priority-icon">📋</span>
            <span>Next priority: 5 urgent prescriptions pending review</span>
          </div>        </div>
        <div class="action-buttons">
          <button class="btn btn-primary" (click)="processOrders()">
            <span class="btn-icon">📅</span>
            Process Orders
          </button>
          <button class="btn btn-secondary" (click)="openQuickChat()">
            <span class="btn-icon">💬</span>
            Quick Chat
          </button>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-container">
      <div class="stat-card yellow">
        <div class="stat-icon">📋</div>
        <div class="stat-number">{{ pharmacyStats.pendingPrescriptions }}</div>
        <div class="stat-label">Pending Prescriptions</div>
      </div>
      <div class="stat-card blue">
        <div class="stat-icon">🧪</div>
        <div class="stat-number">{{ pharmacyStats.labTestRequests }}</div>
        <div class="stat-label">Lab Test Requests</div>
      </div>
      <div class="stat-card red">
        <div class="stat-icon">📦</div>
        <div class="stat-number">{{ pharmacyStats.outOfStockItems }}</div>
        <div class="stat-label">Out-of-Stock Items</div>
      </div>
      <div class="stat-card green">
        <div class="stat-icon">✅</div>
        <div class="stat-number">{{ pharmacyStats.reportsUploaded }}</div>        <div class="stat-label">Reports Uploaded Today</div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <button class="tab-btn" [class.active]="isActiveTab('prescriptions')" (click)="setActiveTab('prescriptions')">
        <span class="tab-icon">📋</span>
        Prescriptions
      </button>
      <button class="tab-btn" [class.active]="isActiveTab('lab-tests')" (click)="setActiveTab('lab-tests')">
        <span class="tab-icon">🧪</span>
        Lab Tests
      </button>
      <button class="tab-btn" [class.active]="isActiveTab('inventory')" (click)="setActiveTab('inventory')">
        <span class="tab-icon">📦</span>
        Inventory
      </button>
      <button class="tab-btn" [class.active]="isActiveTab('reports')" (click)="setActiveTab('reports')">
        <span class="tab-icon">📊</span>
        Reports
      </button>
      <button class="tab-btn" [class.active]="isActiveTab('payments')" (click)="setActiveTab('payments')">
        <span class="tab-icon">💳</span>        Payments
      </button>
    </div>
    
    <!-- Content Sections -->    
     <div class="content-section">
      <!-- Prescriptions Tab -->
      <div class="prescriptions-section" *ngIf="isActiveTab('prescriptions')">
        <div class="section-header">
          <h3>Recent Prescriptions</h3>
          <button class="btn btn-primary" (click)="addNewPrescription()">+ New Prescription</button>
        </div>        <!-- Search and Filter Controls -->
        <div class="search-filter-container">
          <div class="search-box">
            <input 
              type="text" 
              placeholder="Search by patient name, medication, doctor, or ID..." 
              [value]="searchTerm"
              (input)="onSearchChange($any($event.target).value)"
              class="search-input">
            <span class="search-icon">🔍</span>
          </div>
          
          <div class="filter-controls">
            <select 
              [value]="selectedStatus" 
              (change)="onStatusFilterChange($any($event.target).value)"
              class="status-filter">
              <option value="ALL">All Status</option>
              <option value="PENDING">Pending</option>
              <option value="URGENT">Urgent</option>
              <option value="COMPLETED">Completed</option>
              <option value="CANCELLED">Cancelled</option>
            </select>
            
            <button 
              class="clear-filters-btn" 
              (click)="clearFilters()"
              [disabled]="searchTerm === '' && selectedStatus === 'ALL'">
              Clear Filters
            </button>
          </div>        </div>

        <!-- Results Summary -->
        <div class="results-summary" *ngIf="searchTerm || selectedStatus !== 'ALL'">
          <span>Showing {{ filteredPrescriptions.length }} of {{ recentPrescriptions.length }} prescriptions</span>
        </div>

        <div class="prescriptions-list">
        <div class="prescription-item" *ngFor="let prescription of filteredPrescriptions">
          <div class="prescription-status">
            <div class="status-badge" [ngClass]="prescription.status.toLowerCase()">
              {{ prescription.status }}
            </div>
          </div>
          <div class="prescription-content">
            <div class="prescription-details">
              <h4>{{ prescription.patientName }} - {{ prescription.medication }}</h4>
              <p>Prescribed by {{ prescription.doctor }} | Patient ID: {{ prescription.patientId }}</p>
              <div class="prescription-extra-info" *ngIf="prescription.dosage || prescription.frequency">
                <span class="dosage-info" *ngIf="prescription.dosage">
                  <strong>Dosage:</strong> {{ prescription.dosage }}
                </span>
                <span class="frequency-info" *ngIf="prescription.frequency">
                  <strong>Frequency:</strong> {{ prescription.frequency }}
                </span>
                <span class="duration-info" *ngIf="prescription.duration">
                  <strong>Duration:</strong> {{ prescription.duration }}
                </span>
              </div>
              <div class="prescription-notes" *ngIf="prescription.notes">
                <strong>Notes:</strong> {{ prescription.notes }}
              </div>
            </div>
          </div>
          <div class="prescription-meta">
            <div class="prescription-time">
              <span class="time-icon">⏰</span>
              <span class="time">{{ prescription.time }}</span>
              <span class="date">{{ prescription.date }}</span>
            </div>
            <div class="prescription-actions">
              <button 
                class="action-btn approve" 
                *ngIf="prescription.status === 'PENDING' || prescription.status === 'URGENT'"
                (click)="updatePrescriptionStatus(prescription.id!, 'COMPLETED')"
                title="Approve Prescription">
                ✅
              </button>
              <button 
                class="action-btn edit" 
                (click)="editPrescription(prescription)"
                title="Edit Prescription">
                ✏️
              </button>
              <button 
                class="action-btn view" 
                (click)="viewPrescriptionDetails(prescription)"
                title="View Details">
                👁️
              </button>
            </div>
          </div>
        </div>
        
        <!-- No Results Message -->
        <div class="no-results" *ngIf="filteredPrescriptions.length === 0">
          <div class="no-results-icon">📋</div>
          <h4>No prescriptions found</h4>            <p *ngIf="searchTerm || selectedStatus !== 'ALL'">
              Try adjusting your search criteria or clearing filters.
            </p>
            <p *ngIf="!searchTerm && selectedStatus === 'ALL'">
              No prescriptions available at the moment.
            </p>
          </div>
        </div>
      </div>
        
      <!-- Lab Tests Tab -->
      <div class="lab-tests-section" *ngIf="isActiveTab('lab-tests')">
        <div class="section-header">
          <h3>Lab Test Requests</h3>
          <button class="btn btn-primary" (click)="addNewLabTest()">+ New Lab Test</button>
        </div>

        <!-- Search and Filter Controls -->
        <div class="search-filter-container">
          <div class="search-box">
            <input 
              type="text" 
              placeholder="Search by patient name, test name, or ID..." 
              [value]="searchTerm"
              (input)="onSearchChange($any($event.target).value)"
              class="search-input">
            <span class="search-icon">🔍</span>
          </div>
          
          <div class="filter-controls">
            <select 
              [value]="selectedStatus" 
              (change)="onStatusFilterChange($any($event.target).value)"
              class="status-filter">
              <option value="ALL">All Status</option>
              <option value="PENDING">Pending</option>
              <option value="IN_PROGRESS">In Progress</option>
              <option value="COMPLETED">Completed</option>
              <option value="CANCELLED">Cancelled</option>
            </select>
            
            <button 
              class="clear-filters-btn" 
              (click)="clearFilters()"
              [disabled]="searchTerm === '' && selectedStatus === 'ALL'">
              Clear Filters
            </button>
          </div>        </div>

        <!-- Results Summary -->
        <div class="results-summary" *ngIf="searchTerm || selectedStatus !== 'ALL'">
          <span>Showing {{ filteredLabTests.length }} of {{ labTests.length }} lab tests</span>
        </div>

        <div class="lab-tests-list">
          <div class="lab-test-item" *ngFor="let test of filteredLabTests">
            <div class="test-status">
              <div class="status-badge" [ngClass]="test.status.toLowerCase().replace('_', '-')">
                {{ test.status.replace('_', ' ') }}
              </div>
              <div class="priority-badge" [ngClass]="test.priority.toLowerCase()">
                {{ test.priority }}              </div>
            </div>
            <div class="test-content">
              <div class="test-details">
                <h4>{{ test.testName }} - {{ test.patientName }}</h4>
                <p>Requested by {{ test.doctor }} | Patient ID: {{ test.patientId }}</p>
                <div class="test-dates">
                  <span><strong>Requested:</strong> {{ test.requestDate }}</span>
                  <span *ngIf="test.expectedDate"><strong>Expected:</strong> {{ test.expectedDate }}</span>
                </div>
                <div class="test-notes" *ngIf="test.notes">
                  <strong>Notes:</strong> {{ test.notes }}
                </div>
              </div>
            </div>
            <div class="test-actions">
              <button class="action-btn start" *ngIf="test.status === 'PENDING'" (click)="startLabTest(test.id!)" title="Start Test">▶️</button>
              <button class="action-btn complete" *ngIf="test.status === 'IN_PROGRESS'" (click)="completeLabTest(test.id!)" title="Complete Test">✅</button>
              <button class="action-btn edit" (click)="editLabTest(test)" title="Edit Test">✏️</button>
              <button class="action-btn view" (click)="viewLabTestDetails(test)" title="View Details">👁️</button>
            </div>
          </div>
          
          <!-- No Results Message -->
          <div class="no-results" *ngIf="filteredLabTests.length === 0">
            <div class="no-results-icon">🧪</div>
            <h4>No lab tests found</h4>
            <p *ngIf="searchTerm || selectedStatus !== 'ALL'">
              Try adjusting your search criteria or clearing filters.
            </p>
            <p *ngIf="!searchTerm && selectedStatus === 'ALL'">
              No lab tests available at the moment.
            </p>
          </div>
        </div>
      </div>
      
      <!-- Inventory Tab -->
      <div class="inventory-section" *ngIf="isActiveTab('inventory')">
        <div class="section-header">
          <h3>Inventory Management</h3>
          <button class="btn btn-primary" (click)="addNewInventoryItem()">+ Add Item</button>
        </div>

        <!-- Search and Filter Controls -->
        <div class="search-filter-container">
          <div class="search-box">
            <input 
              type="text" 
              placeholder="Search by item name, category, or batch..." 
              [value]="searchTerm"
              (input)="onSearchChange($any($event.target).value)"
              class="search-input">
            <span class="search-icon">🔍</span>
          </div>
          
          <div class="filter-controls">
            <select 
              [value]="selectedStatus" 
              (change)="onStatusFilterChange($any($event.target).value)"
              class="status-filter">
              <option value="ALL">All Status</option>
              <option value="IN_STOCK">In Stock</option>
              <option value="LOW_STOCK">Low Stock</option>
              <option value="OUT_OF_STOCK">Out of Stock</option>              <option value="EXPIRED">Expired</option>
            </select>
            
            <button 
              class="clear-filters-btn" 
              (click)="clearFilters()"
              [disabled]="searchTerm === '' && selectedStatus === 'ALL'">
              Clear Filters
            </button>
          </div>
        </div>

        <!-- Results Summary -->
        <div class="results-summary" *ngIf="searchTerm || selectedStatus !== 'ALL'">
          <span>Showing {{ filteredInventory.length }} of {{ inventoryItems.length }} inventory items</span>
        </div>

        <div class="inventory-list">
          <div class="inventory-item" *ngFor="let item of filteredInventory">
            <div class="item-status">
              <div class="status-badge" [ngClass]="item.status.toLowerCase().replace('_', '-')">
                {{ item.status.replace('_', ' ') }}
              </div>
            </div>
            <div class="item-content">
              <div class="item-details">
                <h4>{{ item.name }}</h4>
                <p><strong>Category:</strong> {{ item.category }} | <strong>Batch:</strong> {{ item.batchNumber }}</p>
                <div class="stock-info">
                  <span><strong>Current Stock:</strong> {{ item.currentStock }}</span>
                  <span><strong>Min Stock:</strong> {{ item.minimumStock }}</span>
                  <span><strong>Unit Price:</strong> ${{ item.unitPrice }}</span>
                </div>
                <div class="item-extra-info">
                  <span><strong>Expiry:</strong> {{ item.expiryDate }}</span>
                  <span><strong>Supplier:</strong> {{ item.supplier }}</span>
                </div>              </div>
            </div>
            <div class="item-actions">
              <button class="action-btn restock" *ngIf="item.status === 'LOW_STOCK' || item.status === 'OUT_OF_STOCK'" (click)="restockItem(item.id!)" title="Restock">📦</button>
              <button class="action-btn edit" (click)="editInventoryItem(item)" title="Edit Item">✏️</button>
              <button class="action-btn view" (click)="viewInventoryItemDetails(item)" title="View Details">👁️</button>
            </div>
          </div>
          
          <!-- No Results Message -->
          <div class="no-results" *ngIf="filteredInventory.length === 0">
            <div class="no-results-icon">📦</div>
            <h4>No inventory items found</h4>
            <p *ngIf="searchTerm || selectedStatus !== 'ALL'">
              Try adjusting your search criteria or clearing filters.
            </p>
            <p *ngIf="!searchTerm && selectedStatus === 'ALL'">
              No inventory items available at the moment.
            </p>
          </div>
        </div>
      </div>
        <!-- Reports Tab -->
      <div class="reports-section" *ngIf="isActiveTab('reports')">
        <div class="section-header">
          <h3>Reports</h3>
          <button class="btn btn-primary" (click)="generateNewReport()">+ Generate Report</button>
        </div>

        <!-- Search and Filter Controls -->
        <div class="search-filter-container">
          <div class="search-box">
            <input 
              type="text" 
              placeholder="Search by report title, type, or generated by..." 
              [value]="searchTerm"
              (input)="onSearchChange($any($event.target).value)"
              class="search-input">
            <span class="search-icon">🔍</span>
          </div>
          
          <div class="filter-controls">
            <select 
              [value]="selectedStatus" 
              (change)="onStatusFilterChange($any($event.target).value)"
              class="status-filter">
              <option value="ALL">All Status</option>
              <option value="DRAFT">Draft</option>
              <option value="FINAL">Final</option>
              <option value="ARCHIVED">Archived</option>
            </select>
            
            <button 
              class="clear-filters-btn" 
              (click)="clearFilters()"
              [disabled]="searchTerm === '' && selectedStatus === 'ALL'">
              Clear Filters
            </button>
          </div>
        </div>

        <!-- Results Summary -->
        <div class="results-summary" *ngIf="searchTerm || selectedStatus !== 'ALL'">
          <span>Showing {{ filteredReports.length }} of {{ reports.length }} reports</span>
        </div>

        <div class="reports-list">
          <div class="report-item" *ngFor="let report of filteredReports">
            <div class="report-status">
              <div class="status-badge" [ngClass]="report.status.toLowerCase()">
                {{ report.status }}
              </div>
            </div>
            <div class="report-content">
              <div class="report-details">
                <h4>{{ report.title }}</h4>
                <p><strong>Type:</strong> {{ report.type }} | <strong>Generated by:</strong> {{ report.generatedBy }}</p>
                <div class="report-info">
                  <span><strong>Date:</strong> {{ report.generatedDate }}</span>
                  <span><strong>Size:</strong> {{ report.fileSize }}</span>
                </div>              </div>
            </div>
            <div class="report-actions">
              <button class="action-btn download" (click)="downloadReport(report.id!)" title="Download Report">⬇️</button>
              <button class="action-btn view" (click)="viewReport(report)" title="View Report">👁️</button>
              <button class="action-btn share" (click)="shareReport(report.id!)" title="Share Report">📤</button>
            </div>
          </div>
          
          <!-- No Results Message -->
          <div class="no-results" *ngIf="filteredReports.length === 0">
            <div class="no-results-icon">📊</div>
            <h4>No reports found</h4>
            <p *ngIf="searchTerm || selectedStatus !== 'ALL'">
              Try adjusting your search criteria or clearing filters.
            </p>
            <p *ngIf="!searchTerm && selectedStatus === 'ALL'">
              No reports available at the moment.
            </p>
          </div>
        </div>
      </div>
      
      <!-- Payments Tab -->
      <div class="payments-section" *ngIf="isActiveTab('payments')">
        <div class="section-header">
          <h3>Payment Transactions</h3>
          <button class="btn btn-primary" (click)="processNewPayment()">+ Process Payment</button>
        </div>

        <!-- Search and Filter Controls -->
        <div class="search-filter-container">
          <div class="search-box">
            <input 
              type="text" 
              placeholder="Search by patient name or transaction ID..." 
              [value]="searchTerm"
              (input)="onSearchChange($any($event.target).value)"
              class="search-input">
            <span class="search-icon">🔍</span>
          </div>
          
          <div class="filter-controls">
            <select 
              [value]="selectedStatus" 
              (change)="onStatusFilterChange($any($event.target).value)"
              class="status-filter">
              <option value="ALL">All Status</option>
              <option value="PENDING">Pending</option>
              <option value="COMPLETED">Completed</option>
              <option value="FAILED">Failed</option>              <option value="REFUNDED">Refunded</option>
            </select>
            
            <button 
              class="clear-filters-btn" 
              (click)="clearFilters()"
              [disabled]="searchTerm === '' && selectedStatus === 'ALL'">
              Clear Filters
            </button>
          </div>
        </div>

        <!-- Results Summary -->
        <div class="results-summary" *ngIf="searchTerm || selectedStatus !== 'ALL'">
          <span>Showing {{ filteredPayments.length }} of {{ payments.length }} payments</span>
        </div>

        <div class="payments-list">
          <div class="payment-item" *ngFor="let payment of filteredPayments">
            <div class="payment-status">
              <div class="status-badge" [ngClass]="payment.status.toLowerCase()">
                {{ payment.status }}
              </div>
            </div>
            <div class="payment-content">
              <div class="payment-details">
                <h4>{{ payment.patientName }} - ${{ payment.amount }}</h4>
                <p>Patient ID: {{ payment.patientId }} | <strong>Method:</strong> {{ payment.paymentMethod }}</p>
                <div class="payment-info">
                  <span><strong>Date:</strong> {{ payment.transactionDate }}</span>
                  <span *ngIf="payment.discount"><strong>Discount:</strong> ${{ payment.discount }}</span>
                  <span *ngIf="payment.tax"><strong>Tax:</strong> ${{ payment.tax }}</span>
                </div>
                <div class="payment-items">
                  <strong>Items:</strong> {{ payment.items.join(', ') }}
                </div>              </div>
            </div>
            <div class="payment-actions">
              <button class="action-btn print" (click)="printReceipt(payment.id!)" title="Print Receipt">🖨️</button>
              <button class="action-btn refund" *ngIf="payment.status === 'COMPLETED'" (click)="processRefund(payment.id!)" title="Process Refund">↩️</button>
              <button class="action-btn view" (click)="viewPaymentDetails(payment)" title="View Details">👁️</button>
            </div>
          </div>
          
          <!-- No Results Message -->
          <div class="no-results" *ngIf="filteredPayments.length === 0">
            <div class="no-results-icon">💳</div>
            <h4>No payments found</h4>
            <p *ngIf="searchTerm || selectedStatus !== 'ALL'">
              Try adjusting your search criteria or clearing filters.
            </p>
            <p *ngIf="!searchTerm && selectedStatus === 'ALL'">
              No payments available at the moment.
            </p>
          </div>        </div>
      </div>
    </div>  </div>

  <!-- Prescription Details Modal -->
  <app-prescription-modal
    [isVisible]="isModalVisible"
    [prescription]="selectedPrescription"
    [labTest]="selectedLabTest"
    [inventoryItem]="selectedInventoryItem"
    [modalType]="modalType"
    [isNew]="isNewPrescription"
    (close)="closeModal()"
    (edit)="onEditFromModal($event)"
    (save)="onSavePrescription($event)"
    (saveLabTest)="onSaveLabTest($event)"
    (saveInventoryItem)="onSaveInventoryItem($event)">
  </app-prescription-modal>
</div>