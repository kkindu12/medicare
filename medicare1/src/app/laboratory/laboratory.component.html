<div class="laboratory-container">
  <div class="search-container">
    <input type="text" class="search-bar" placeholder="Search by test name, category..." (input)="filterTests($event)">
    
    <div class="filter-row">
      <div class="filter-group">
        <label for="test-category">Test Category:</label>
        <select id="test-category" class="filter-select" (change)="filterByCategory($event)">
          <option value="">All Categories</option>
          <option value="blood">Blood Tests</option>
          <option value="urine">Urine Tests</option>
          <option value="imaging">Imaging</option>
          <option value="microbiology">Microbiology</option>
          <option value="special">Special Tests</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="turnaround">Turnaround Time:</label>
        <select id="turnaround" class="filter-select" (change)="filterByTurnaround($event)">
          <option value="">All Timeframes</option>
          <option value="same-day">Same Day</option>
          <option value="24-hours">24 Hours</option>
          <option value="48-hours">48 Hours</option>
          <option value="3-5-days">3-5 Days</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="lab-location">Lab Location:</label>
        <select id="lab-location" class="filter-select" (change)="filterByLocation($event)">
          <option value="">All Locations</option>
          <option value="main">Main Laboratory</option>
          <option value="emergency">Emergency Lab</option>
          <option value="outpatient">Outpatient Center</option>
          <option value="reference">Reference Lab</option>
        </select>
      </div>
    </div>
    
    <button class="clear-btn" (click)="clearFilters()">Clear Filters</button>
  </div>
  
  <h2 class="section-title">Available Tests ({{ filteredTests.length }})</h2>
  
  <div class="tabs">
    <div class="tab" [class.active]="activeTab === 'all-tests'" data-target="all-tests" (click)="switchTab('all-tests')">All Tests</div>
    <div class="tab" [class.active]="activeTab === 'common'" data-target="common" (click)="switchTab('common')">Common Tests</div>
    <div class="tab" [class.active]="activeTab === 'special'" data-target="special" (click)="switchTab('special')">Special Tests</div>
    <div class="tab" [class.active]="activeTab === 'panels'" data-target="panels" (click)="switchTab('panels')">Test Panels</div>
  </div>
  
  <div class="card-container">
    <div class="card" *ngFor="let test of filteredTests">
      <h3>{{ test.name }}</h3>
      <p>Category: {{ test.category }}</p>
      <p>Turnaround: {{ test.turnaround }}</p>
      <p>Lab Location: {{ test.location }}</p>
      <p>Price: ${{ test.price.toFixed(2) }}</p>
      <button class="btn btn-primary" (click)="openTestRequestModal(test.name)">Request Test</button>
    </div>
  </div>
</div>

<!-- Request Test Modal -->
<div id="testRequestModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Request Laboratory Test</h2>
      <button class="close-btn" (click)="closeModal('testRequestModal')">&times;</button>
    </div>
    
    <form (ngSubmit)="submitTestRequest()" #testForm="ngForm">
      <div class="form-group">
        <label for="testName">Test:</label>
        <input type="text" id="testName" class="form-control" [(ngModel)]="selectedTestRequest.testName" name="testName" readonly>
      </div>
      
      <div class="form-group">
        <label for="patientIdTest">Patient ID:</label>
        <input type="text" id="patientIdTest" class="form-control" [(ngModel)]="selectedTestRequest.patientId" name="patientId" required>
      </div>
      
      <div class="form-group">
        <label for="referringDoctor">Referring Doctor:</label>
        <input type="text" id="referringDoctor" class="form-control" [(ngModel)]="selectedTestRequest.referringDoctor" name="referringDoctor" required>
      </div>
      
      <div class="form-group">
        <label for="gender">Gender:</label>
        <select id="gender" class="form-control" [(ngModel)]="selectedTestRequest.gender" name="gender">
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="collectionDate">Preferred Date:</label>
        <input type="date" id="collectionDate" class="form-control" [(ngModel)]="selectedTestRequest.collectionDate" name="collectionDate" required>
      </div>

      <div class="form-group">
        <label for="preferredTime">Preferred Time:</label>
        <select id="preferredTime" class="form-control" [(ngModel)]="selectedTestRequest.preferredTime" name="preferredTime">
          <option value="morning">Morning (8:00 AM - 12:00 PM)</option>
          <option value="afternoon">Afternoon (12:00 PM - 4:00 PM)</option>
          <option value="evening">Evening (4:00 PM - 8:00 PM)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="doctorReferral">Upload Doctor's Referral:</label>
        <div class="file-upload-container">
          <input type="file" id="doctorReferral" class="file-input" 
                 accept=".pdf,.jpg,.jpeg,.png,.gif" 
                 (change)="onReferralFileSelected($event)" 
                 #referralFileInput>
          <label for="doctorReferral" class="file-upload-label">
            <i class="upload-icon">ðŸ“Ž</i>
            <span>{{ selectedReferralFile ? selectedReferralFile.name : 'Choose file or drag here' }}</span>
          </label>
          <div class="file-info" *ngIf="selectedReferralFile">
            <small>{{ selectedReferralFile.name }} ({{ formatFileSize(selectedReferralFile.size) }})</small>
            <button type="button" class="remove-file-btn" (click)="removeReferralFile()">&times;</button>
          </div>
        </div>
        <small class="form-text">Accepted formats: PDF, JPG, JPEG, PNG, GIF (Max 5MB)</small>
      </div>
      
      <div class="form-group">
        <label for="clinicalInfo">Clinical Information:</label>
        <textarea id="clinicalInfo" class="form-control" [(ngModel)]="selectedTestRequest.clinicalInfo" name="clinicalInfo"></textarea>
      </div>
      
      <div class="btn-group">
        <button type="button" class="btn btn-outline" (click)="closeModal('testRequestModal')">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="!testForm.form.valid">Submit Request</button>
      </div>
    </form>
  </div>
</div>
